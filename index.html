<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TANGEDCO - Electrical Complaint Management</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Role Switcher (Hidden for prototype) -->
    <div class="role-switcher" id="roleSwitcher">
        <select id="roleSelect" class="form-control">
            <option value="local">T Nagar EB Office - Local Unit</option>
            <option value="department">TANGEDCO Chennai EDC - Department Board</option>
            <option value="central">Chennai Corporation - Central Authority</option>
        </select>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%23013d5b' stroke='%23fff' stroke-width='2'/%3E%3Ctext x='16' y='12' text-anchor='middle' fill='white' font-family='Arial' font-size='8' font-weight='bold'%3EEBCO%3C/text%3E%3Ctext x='16' y='22' text-anchor='middle' fill='white' font-family='Arial' font-size='6'%3ETNEB%3C/text%3E%3C/svg%3E" alt="TANGEDCO" class="header-logo">
            <div class="header-title">
                <h1 id="headerTitle">T Nagar EB Office</h1>
                <span id="headerSubtitle">Electrical Complaint Management</span>
            </div>
            <button class="notification-btn" id="notificationBtn">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notificationBadge">3</span>
            </button>
        </div>
    </header>

    <!-- Emergency Contact Banner -->
    <div class="emergency-banner" id="emergencyBanner">
        <div class="emergency-content">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Emergency: Call 1912 (FOC) | WhatsApp: 9445850829</span>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="main-content" id="mainContent">
        
        <!-- Local Unit Views - T Nagar EB Office -->
        <div class="view local-view active" id="localView">
            <!-- Dashboard -->
            <div class="page active" id="localDashboard">
                <div class="page-header">
                    <h2>T Nagar EB Office Dashboard</h2>
                    <p>Assistant Engineer/O&M - Area Coverage: Pondy Bazaar, Ranganathan Street</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card priority-critical">
                        <div class="stat-number">2</div>
                        <div class="stat-label">Emergency</div>
                        <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                    </div>
                    <div class="stat-card priority-high">
                        <div class="stat-number">8</div>
                        <div class="stat-label">High Priority</div>
                        <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    </div>
                    <div class="stat-card priority-medium">
                        <div class="stat-number">12</div>
                        <div class="stat-label">Work Orders</div>
                        <div class="stat-icon"><i class="fas fa-tools"></i></div>
                    </div>
                    <div class="stat-card priority-low">
                        <div class="stat-number">22</div>
                        <div class="stat-label">Pending</div>
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    </div>
                </div>
                <div class="map-dashboard-section">
                    <div class="section-header">
                        <h3>T Nagar Area Status Map</h3>
                        <div class="map-controls">
                            <button class="map-toggle-btn active" data-view="street">Street View</button>
                            <button class="map-toggle-btn" data-view="density">Density View</button>
                        </div>
                    </div>
                    
                    <div class="dashboard-map-container">
                        <!-- Street Map View -->
                        <div class="dashboard-map-view active" id="streetMapView">
                            <div class="map-canvas">
                                <!-- Main Roads -->
                                <div class="map-road main-road horizontal" style="top: 35%; height: 8px;"></div>
                                <div class="map-road secondary-road horizontal" style="top: 55%; height: 6px;"></div>
                                <div class="map-road secondary-road horizontal" style="top: 75%; height: 6px;"></div>
                                <div class="map-road main-road vertical" style="left: 25%; width: 8px;"></div>
                                <div class="map-road secondary-road vertical" style="left: 65%; width: 6px;"></div>

                                <!-- Area Labels -->
                                <div class="area-label main" style="top: 28%; left: 8%;">Pondy Bazaar</div>
                                <div class="area-label" style="top: 48%; left: 8%;">Ranganathan Street</div>
                                <div class="area-label" style="top: 68%; left: 8%;">Usman Road</div>
                                <div class="area-label vertical" style="top: 8%; left: 18%;">GN Chetty Road</div>
                                <div class="area-label vertical" style="top: 8%; left: 58%;">Habibullah Road</div>

                                <!-- Buildings/Blocks -->
                                <div class="building-block" style="top: 20%; left: 35%; width: 25%; height: 12%;"></div>
                                <div class="building-block" style="top: 40%; left: 35%; width: 25%; height: 12%;"></div>
                                <div class="building-block" style="top: 60%; left: 35%; width: 25%; height: 12%;"></div>
                                <div class="building-block" style="top: 40%; left: 70%; width: 25%; height: 15%;"></div>

                                <!-- Infrastructure -->
                                <div class="infrastructure-item transformer critical" style="top: 52%; left: 47%;" data-tooltip="T-NG-15 - Overloaded - 120 consumers">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="infrastructure-item transformer normal" style="top: 32%; left: 72%;" data-tooltip="T-NG-23 - Normal Operation">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="infrastructure-item transformer maintenance" style="top: 72%; left: 22%;" data-tooltip="T-NG-08 - Scheduled Maintenance">
                                    <i class="fas fa-bolt"></i>
                                </div>

                                <!-- Street Lights -->
                                <div class="infrastructure-item streetlight broken" style="top: 37%; left: 75%;" data-tooltip="Pole PB-45 - LED Bulb Damaged">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="infrastructure-item streetlight working" style="top: 57%; left: 30%;" data-tooltip="Street Light - Working">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="infrastructure-item streetlight working" style="top: 77%; left: 50%;" data-tooltip="Street Light - Working">
                                    <i class="fas fa-lightbulb"></i>
                                </div>

                                <!-- Complaint Markers -->
                                <div class="complaint-pin critical" style="top: 52%; left: 47%;" data-tooltip="TNE2025002 - Power Cuts - Critical">
                                    <div class="pin-head"></div>
                                    <div class="pin-point"></div>
                                </div>
                                <div class="complaint-pin high" style="top: 37%; left: 75%;" data-tooltip="TNE2025001 - Street Light - High Priority">
                                    <div class="pin-head"></div>
                                    <div class="pin-point"></div>
                                </div>
                                <div class="complaint-pin medium" style="top: 72%; left: 82%;" data-tooltip="TNE2025003 - Voltage Issues - Medium">
                                    <div class="pin-head"></div>
                                    <div class="pin-point"></div>
                                </div>
                                <div class="complaint-pin resolved" style="top: 27%; left: 40%;" data-tooltip="TNE2025005 - Cable Spark - Resolved">
                                    <div class="pin-head"></div>
                                    <div class="pin-point"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Density Map View -->
                        <div class="dashboard-map-view" id="densityMapView">
                            <div class="density-canvas">
                                <!-- Base Map with subtle roads -->
                                <div class="density-road horizontal" style="top: 35%; height: 3px;"></div>
                                <div class="density-road horizontal" style="top: 55%; height: 3px;"></div>
                                <div class="density-road horizontal" style="top: 75%; height: 3px;"></div>
                                <div class="density-road vertical" style="left: 25%; width: 3px;"></div>
                                <div class="density-road vertical" style="left: 65%; width: 3px;"></div>

                                <!-- Density Heat Zones -->
                                <div class="density-zone critical-zone" style="top: 40%; left: 35%; width: 130px; height: 130px;"></div>
                                <div class="density-zone high-zone" style="top: 25%; left: 65%; width: 90px; height: 90px;"></div>
                                <div class="density-zone medium-zone" style="top: 65%; left: 75%; width: 80px; height: 80px;"></div>
                                <div class="density-zone low-zone" style="top: 15%; left: 15%; width: 70px; height: 70px;"></div>
                                <div class="density-zone low-zone" style="top: 70%; left: 10%; width: 75px; height: 75px;"></div>

                                <!-- Area Labels on Density Map -->
                                <div class="density-label" style="top: 28%; left: 8%;">Pondy Bazaar</div>
                                <div class="density-label" style="top: 48%; left: 8%;">Ranganathan St.</div>
                                <div class="density-label" style="top: 68%; left: 8%;">Usman Road</div>
                            </div>

                            <!-- Density Legend -->
                            <div class="density-legend">
                                <div class="legend-title">Issue Density</div>
                                <div class="legend-item">
                                    <div class="legend-indicator critical"></div>
                                    <span>Critical (3+ active)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-indicator high"></div>
                                    <span>High (2-3 issues)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-indicator medium"></div>
                                    <span>Medium (1-2 issues)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-indicator low"></div>
                                    <span>Low (0-1 issues)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Map Tooltip -->
                        <div class="map-tooltip" id="mapTooltip"></div>
                    </div>
                </div>   
                <div class="section-title">
                    <h3>Priority Electrical Complaints</h3>
                    <button class="btn btn--sm btn--outline">View All</button>
                </div>

                <!-- UPDATED: TABLE STRUCTURE FOR COMPLAINTS -->
                <div class="complaint-table-container" id="priorityComplaints">
                    <table class="complaint-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Issue</th>
                                <th>Location</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Work Order</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="complaint-row priority-critical">
                                <td class="complaint-id">TNE2025002</td>
                                <td class="complaint-issue">
                                    <strong>Power Cuts - Ranganathan Street</strong>
                                    <br><small>Transformer T-NG-15 overloading. 120 consumers affected</small>
                                </td>
                                <td>
                                    <i class="fas fa-map-marker-alt"></i> Near Naidu Hall
                                    <br><small>2 days ago</small>
                                </td>
                                <td><span class="priority-badge critical">Critical</span></td>
                                <td><span class="status status--warning">In Progress</span></td>
                                <td class="work-order">WO/TNE/2025/0046</td>
                                <td>
                                    <button class="btn btn--sm btn--primary">Update</button>
                                </td>
                            </tr>
                            <tr class="complaint-row priority-high">
                                <td class="complaint-id">TNE2025001</td>
                                <td class="complaint-issue">
                                    <strong>Street Light Not Working - Pondy Bazaar</strong>
                                    <br><small>LED bulb damaged in pole PB-45</small>
                                </td>
                                <td>
                                    <i class="fas fa-lightbulb"></i> Pole PB-45
                                    <br><small>4 days ago</small>
                                </td>
                                <td><span class="priority-badge high">High</span></td>
                                <td><span class="status status--info">Work Order Issued</span></td>
                                <td class="work-order">WO/TNE/2025/0045</td>
                                <td>
                                    <button class="btn btn--sm btn--outline">View</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="recent-activity">
                    <h3>Recent Field Activity</h3>
                    <div class="activity-list">
                        <div class="activity-item">
                            <i class="fas fa-check-circle activity-icon success"></i>
                            <div class="activity-content">
                                <p>Cable spark near bus stop resolved - Emergency Team</p>
                                <span class="activity-time">2 hours ago</span>
                            </div>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-wrench activity-icon warning"></i>
                            <div class="activity-content">
                                <p>Transformer maintenance scheduled for T-NG-08</p>
                                <span class="activity-time">4 hours ago</span>
                            </div>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-user-plus activity-icon info"></i>
                            <div class="activity-content">
                                <p>New service connection request assigned - GN Chetty Road</p>
                                <span class="activity-time">6 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Electrical Complaints -->
            
            <!-- Electrical Complaints -->
            <div class="page" id="localComplaints">
                <div class="page-header">
                    <h2>Electrical Complaints</h2>
                    <div class="search-bar">
                        <input type="text" placeholder="Search by pole number, transformer..." class="form-control" id="complaintSearch">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <div class="filters-bar">
                    <select class="form-control filter-select" id="categoryFilter">
                        <option value="">All Categories</option>
                        <option value="street-light">Street Light Issues</option>
                        <option value="power-supply">Power Supply Problems</option>
                        <option value="transformer">Transformer Issues</option>
                        <option value="meter">Meter Related</option>
                        <option value="cable">Cable/Infrastructure</option>
                        <option value="service">Service Connections</option>
                    </select>
                    <select class="form-control filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="open">Open</option>
                        <option value="verified">Verified</option>
                        <option value="work-order">Work Order</option>
                        <option value="in-progress">In Progress</option>
                        <option value="testing">Testing</option>
                        <option value="resolved">Resolved</option>
                    </select>
                </div>

                <!-- UPDATED: TABLE STRUCTURE FOR ALL COMPLAINTS -->
                <div class="complaint-table-container detailed" id="allComplaints">
  <table class="complaint-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Issue & Description</th>
        <th>Location & Time</th>
        <th>Category</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="complaintsTableBody">
      <!-- JS will insert rows here -->
    </tbody>
  </table>
</div>
            </div>

            <!-- Field Work -->
            <div class="page" id="localFieldWork">
                <div class="page-header">
                    <h2>Field Work Management</h2>
                    <button class="btn btn--sm btn--primary">Create Work Order</button>
                </div>

                <div class="field-stats">
                    <div class="field-stat">
                        <span class="field-number">5</span>
                        <span class="field-label">Active Work Orders</span>
                    </div>
                    <div class="field-stat">
                        <span class="field-number">2</span>
                        <span class="field-label">Emergency Calls</span>
                    </div>
                    <div class="field-stat">
                        <span class="field-number">15</span>
                        <span class="field-label">Scheduled Today</span>
                    </div>
                </div>

                <!-- UPDATED: TABLE STRUCTURE FOR WORK ORDERS -->
                <div class="work-orders">
                    <h3>Today's Work Orders</h3>
                    <div class="work-order-table-container">
                        <table class="work-order-table">
                            <thead>
                                <tr>
                                    <th>Work Order ID</th>
                                    <th>Task & Details</th>
                                    <th>Location</th>
                                    <th>Assigned To</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="work-order-row emergency">
                                    <td class="work-order-id">WO/TNE/2025/0046</td>
                                    <td class="work-order-task">
                                        <strong>Transformer Overload - Ranganathan Street</strong>
                                        <br><small>Load balancing required urgently for T-NG-15</small>
                                    </td>
                                    <td>
                                        <i class="fas fa-map-marker-alt"></i> T-NG-15, Near Naidu Hall
                                    </td>
                                    <td>
                                        <i class="fas fa-user"></i> AE Ramesh Kumar
                                    </td>
                                    <td><span class="priority-badge emergency">Emergency</span></td>
                                    <td><span class="status status--warning">In Progress</span></td>
                                    <td>
                                        <button class="btn btn--sm btn--primary">Update</button>
                                        <button class="btn btn--sm btn--outline">Details</button>
                                    </td>
                                </tr>
                                <tr class="work-order-row high">
                                    <td class="work-order-id">WO/TNE/2025/0045</td>
                                    <td class="work-order-task">
                                        <strong>Street Light Repair - Pondy Bazaar</strong>
                                        <br><small>LED bulb replacement needed for pole PB-45</small>
                                    </td>
                                    <td>
                                        <i class="fas fa-lightbulb"></i> Pole PB-45
                                    </td>
                                    <td>
                                        <i class="fas fa-user"></i> AE Subramanian
                                    </td>
                                    <td><span class="priority-badge high">High</span></td>
                                    <td><span class="status status--info">Scheduled</span></td>
                                    <td>
                                        <button class="btn btn--sm btn--primary">Start</button>
                                        <button class="btn btn--sm btn--outline">Details</button>
                                    </td>
                                </tr>
                                <tr class="work-order-row medium">
                                    <td class="work-order-id">WO/TNE/2025/0047</td>
                                    <td class="work-order-task">
                                        <strong>Cable Maintenance - Habibullah Road</strong>
                                        <br><small>Routine inspection and testing of underground cables</small>
                                    </td>
                                    <td>
                                        <i class="fas fa-plug"></i> Habibullah Road Junction
                                    </td>
                                    <td>
                                        <i class="fas fa-user"></i> Technician Team A
                                    </td>
                                    <td><span class="priority-badge medium">Medium</span></td>
                                    <td><span class="status status--success">Completed</span></td>
                                    <td>
                                        <button class="btn btn--sm btn--outline">Report</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="equipment-tracking">
                    <h3>Equipment & Materials</h3>
                    <div class="equipment-grid">
                        <div class="equipment-item">
                            <i class="fas fa-lightbulb"></i>
                            <span class="equipment-name">LED Bulbs</span>
                            <span class="equipment-stock">24 available</span>
                        </div>
                        <div class="equipment-item">
                            <i class="fas fa-bolt"></i>
                            <span class="equipment-name">Fuses</span>
                            <span class="equipment-stock">45 available</span>
                        </div>
                        <div class="equipment-item">
                            <i class="fas fa-plug"></i>
                            <span class="equipment-name">Cables</span>
                            <span class="equipment-stock">200m available</span>
                        </div>
                        <div class="equipment-item low-stock">
                            <i class="fas fa-battery-quarter"></i>
                            <span class="equipment-name">Transformers</span>
                            <span class="equipment-stock">2 available</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Communication -->
            <div class="page" id="localCommunication">
                <div class="page-header">
                    <h2>Communication Hub</h2>
                    <button class="btn btn--sm btn--primary">New Message</button>
                </div>

                <div class="communication-tabs">
                    <button class="tab-btn active" data-tab="internal">TANGEDCO Internal</button>
                    <button class="tab-btn" data-tab="citizens">Citizens</button>
                    <button class="tab-btn" data-tab="whatsapp">WhatsApp Updates</button>
                </div>

                <div class="tab-content active" id="internal">
                    <div class="message-list">
                        <div class="message-item urgent">
                            <div class="message-header">
                                <strong>Dr. S. Muralidharan - SE Chennai EDC</strong>
                                <span class="message-time">30 min ago</span>
                            </div>
                            <p>Priority alert: Multiple transformer overload reports. Need immediate action plan for Ranganathan Street area.</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--primary">Send Report</button>
                            </div>
                        </div>
                        <div class="message-item">
                            <div class="message-header">
                                <strong>AE Ramesh Kumar - Transformer Team</strong>
                                <span class="message-time">2 hours ago</span>
                            </div>
                            <p>Transformer T-NG-15 load testing completed. Requires immediate load balancing. Photos uploaded to system.</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--outline">View Photos</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="citizens">
                    <div class="message-list">
                        <div class="message-item">
                            <div class="message-header">
                                <strong>M. Rajesh (Consumer: 12304567890)</strong>
                                <span class="message-time">1 hour ago</span>
                            </div>
                            <p>Thank you for fixing the street light on Pondy Bazaar. Much appreciated!</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--outline">Send SMS Update</button>
                            </div>
                        </div>
                        <div class="message-item">
                            <div class="message-header">
                                <strong>Shop Owners Association</strong>
                                <span class="message-time">3 hours ago</span>
                            </div>
                            <p>Power cuts affecting business. When will transformer issue be resolved?</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--primary">Send Update</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="whatsapp">
                    <div class="whatsapp-info">
                        <div class="whatsapp-banner">
                            <i class="fab fa-whatsapp"></i>
                            <div class="whatsapp-details">
                                <h4>Chennai TANGEDCO WhatsApp</h4>
                                <p>9445850829 - For photo complaints and updates</p>
                            </div>
                        </div>
                        <div class="whatsapp-stats">
                            <div class="whatsapp-stat">
                                <span class="whatsapp-number">156</span>
                                <span class="whatsapp-label">Messages Today</span>
                            </div>
                            <div class="whatsapp-stat">
                                <span class="whatsapp-number">42</span>
                                <span class="whatsapp-label">Photo Complaints</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile -->
            <div class="page" id="localProfile">
                <div class="page-header">
                    <h2>Engineer Profile</h2>
                </div>

                <div class="profile-card">
                    <div class="profile-avatar">
                        <i class="fas fa-hard-hat"></i>
                    </div>
                    <div class="profile-info">
                        <h3>V. Subramanian</h3>
                        <p>Assistant Engineer/O&M</p>
                        <p>T Nagar EB Office - TANGEDCO</p>
                        <p>Employee ID: TNE001</p>
                    </div>
                </div>

                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-number">164</span>
                        <span class="stat-label">Complaints Resolved</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">18hr</span>
                        <span class="stat-label">Avg Resolution</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">91%</span>
                        <span class="stat-label">Customer Satisfaction</span>
                    </div>
                </div>

                <div class="engineer-details">
                    <div class="detail-section">
                        <h4>Contact Information</h4>
                        <div class="contact-info">
                            <span><i class="fas fa-phone"></i> +91 9445850123</span>
                            <span><i class="fas fa-envelope"></i> ae.tnagar@tnebnet.org</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h4>Area Coverage</h4>
                        <div class="coverage-areas">
                            <span class="area-tag">Pondy Bazaar</span>
                            <span class="area-tag">Ranganathan Street</span>
                            <span class="area-tag">Usman Road</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h4>Specialization</h4>
                        <p>Street Lighting & Distribution - 12 years experience</p>
                    </div>
                </div>

                <div class="emergency-contacts">
                    <h4>Emergency Contacts</h4>
                    <div class="emergency-list">
                        <div class="emergency-item">
                            <span class="emergency-label">FOC (Fuse Off Call)</span>
                            <span class="emergency-number">1912</span>
                        </div>
                        <div class="emergency-item">
                            <span class="emergency-label">Emergency Repair</span>
                            <span class="emergency-number">9445850811</span>
                        </div>
                        <div class="emergency-item">
                            <span class="emergency-label">T Nagar Office</span>
                            <span class="emergency-number">044-2434-1101</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Department Board Views - TANGEDCO Chennai EDC -->
        <div class="view department-view" id="departmentView">
            <!-- Analytics -->
            <div class="page active" id="deptAnalytics">
                <div class="page-header">
                    <h2>Chennai EDC Analytics</h2>
                    <p>Circle-wide Electrical Performance Metrics</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">2,156</div>
                        <div class="stat-label">Total Complaints</div>
                        <div class="stat-trend positive">↑ 8%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">1,987</div>
                        <div class="stat-label">Resolved</div>
                        <div class="stat-trend positive">↑ 12%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">169</div>
                        <div class="stat-label">Pending</div>
                        <div class="stat-trend negative">↓ 5%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">87%</div>
                        <div class="stat-label">SLA Compliance</div>
                        <div class="stat-trend positive">↑ 2%</div>
                    </div>
                </div>

                <div class="chart-container" style="position: relative; height: 300px; margin: 20px 0;">
                    <canvas id="deptChart"></canvas>
                </div>

                <div class="eb-offices-performance">
                    <h3>EB Office Performance</h3>
                    <div class="office-list">
                        <div class="office-item">
                            <div class="office-name">T Nagar EB Office</div>
                            <div class="office-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 91%"></div>
                                </div>
                                <span>91%</span>
                            </div>
                        </div>
                        <div class="office-item">
                            <div class="office-name">Mylapore EB Office</div>
                            <div class="office-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 88%"></div>
                                </div>
                                <span>88%</span>
                            </div>
                        </div>
                        <div class="office-item">
                            <div class="office-name">Adyar EB Office</div>
                            <div class="office-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%"></div>
                                </div>
                                <span>85%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Monitor -->
            <div class="page" id="deptLive">
                <div class="page-header">
                    <h2>Live Electrical Monitoring</h2>
                    <div class="live-indicator">
                        <span class="pulse-dot"></span>
                        <span>Real-time TANGEDCO</span>
                    </div>
                </div>

                <div class="live-stats">
                    <div class="live-stat">
                        <span class="live-number">8</span>
                        <span class="live-label">New Today</span>
                    </div>
                    <div class="live-stat">
                        <span class="live-number">22</span>
                        <span class="live-label">In Progress</span>
                    </div>
                    <div class="live-stat">
                        <span class="live-number">5</span>
                        <span class="live-label">Emergency</span>
                    </div>
                </div>

                <div class="live-complaints-list">
                    <div class="live-complaint new electrical">
                        <div class="complaint-time">2 min ago</div>
                        <h4>Voltage Fluctuation - Usman Road</h4>
                        <p>Severe voltage drops to 180V affecting 85 consumers near Spencer Plaza</p>
                        <div class="electrical-details">
                            <span><i class="fas fa-bolt"></i> Power Quality Issue</span>
                            <span><i class="fas fa-users"></i> 85 consumers affected</span>
                        </div>
                        <div class="complaint-actions">
                            <button class="btn btn--sm btn--primary">Assign Engineer</button>
                            <button class="btn btn--sm btn--outline">View Details</button>
                        </div>
                    </div>
                    
                    <div class="live-complaint electrical">
                        <div class="complaint-time">8 min ago</div>
                        <h4>Meter Reading Error - Habibullah Road</h4>
                        <p>Consumer reports abnormally high consumption - requires meter testing</p>
                        <div class="electrical-details">
                            <span><i class="fas fa-tachometer-alt"></i> Meter HB4501234</span>
                            <span><i class="fas fa-user"></i> Consumer: 45012340567</span>
                        </div>
                        <div class="complaint-actions">
                            <button class="btn btn--sm btn--primary">Assign Meter Reader</button>
                            <button class="btn btn--sm btn--outline">View Details</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance -->
            <div class="page" id="deptPerformance">
                <div class="page-header">
                    <h2>TANGEDCO Performance Metrics</h2>
                </div>

                <div class="kpi-grid">
                    <div class="kpi-card">
                        <h4>Resolution Rate</h4>
                        <div class="kpi-value">92.1%</div>
                        <div class="kpi-trend positive">+1.8% from last month</div>
                    </div>
                    <div class="kpi-card">
                        <h4>Emergency Response Time</h4>
                        <div class="kpi-value">45 min</div>
                        <div class="kpi-trend positive">-15 min from last month</div>
                    </div>
                    <div class="kpi-card">
                        <h4>Customer Satisfaction</h4>
                        <div class="kpi-value">91%</div>
                        <div class="kpi-trend positive">+3% from last month</div>
                    </div>
                    <div class="kpi-card">
                        <h4>Power Quality Index</h4>
                        <div class="kpi-value">87.5%</div>
                        <div class="kpi-trend negative">-1.2% from last month</div>
                    </div>
                </div>

                <div class="performance-charts">
                    <h3>Monthly Electrical Performance Trends</h3>
                    <div class="chart-container" style="position: relative; height: 250px;">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <div class="infrastructure-status">
                    <h3>T Nagar Infrastructure Status</h3>
                    <div class="infrastructure-grid">
                        <div class="infra-item">
                            <i class="fas fa-bolt"></i>
                            <span class="infra-name">Transformers</span>
                            <span class="infra-status good">3 Active</span>
                            <span class="infra-detail">1 Overloaded</span>
                        </div>
                        <div class="infra-item">
                            <i class="fas fa-lightbulb"></i>
                            <span class="infra-name">Street Lights</span>
                            <span class="infra-status good">221/245 Working</span>
                            <span class="infra-detail">24 Need Repair</span>
                        </div>
                        <div class="infra-item">
                            <i class="fas fa-home"></i>
                            <span class="infra-name">Service Connections</span>
                            <span class="infra-status good">14,835 Active</span>
                            <span class="infra-detail">45 Pending</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Territory -->
            <div class="page" id="deptTerritory">
                <div class="page-header">
                    <h2>Chennai EDC Territory Map</h2>
                </div>

                <div class="territory-container">
                    <div class="mock-territory-map">
                        <div class="territory-regions">
                            <div class="territory-region high-activity" style="top: 20%; left: 30%; width: 25%; height: 20%;">
                                <span class="region-label">T Nagar<br>High Activity</span>
                            </div>
                            <div class="territory-region medium-activity" style="top: 50%; left: 60%; width: 30%; height: 25%;">
                                <span class="region-label">Mylapore<br>Medium Activity</span>
                            </div>
                            <div class="territory-region low-activity" style="top: 70%; left: 10%; width: 20%; height: 15%;">
                                <span class="region-label">Adyar<br>Low Activity</span>
                            </div>
                        </div>
                        <div class="map-overlay">
                            <p>Chennai EDC Coverage Area</p>
                            <p>Electrical complaint density heatmap</p>
                        </div>
                    </div>
                </div>

                <div class="territory-legend">
                    <h4>Complaint Density (Last 30 Days)</h4>
                    <div class="density-scale">
                        <div class="scale-item">
                            <div class="scale-color low"></div>
                            <span>Low (1-20)</span>
                        </div>
                        <div class="scale-item">
                            <div class="scale-color medium"></div>
                            <span>Medium (21-50)</span>
                        </div>
                        <div class="scale-item">
                            <div class="scale-color high"></div>
                            <span>High (50+)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div class="page" id="deptSettings">
                <div class="page-header">
                    <h2>TANGEDCO Settings</h2>
                </div>

                <div class="settings-sections">
                    <div class="settings-section">
                        <h3>Notification Preferences</h3>
                        <div class="setting-item">
                            <span>Emergency Electrical Faults</span>
                            <label class="toggle">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Transformer Overload Alerts</span>
                            <label class="toggle">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Daily Performance Reports</span>
                            <label class="toggle">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>SLA Configuration</h3>
                        <div class="form-group">
                            <label class="form-label">Emergency Response Time (minutes)</label>
                            <input type="number" class="form-control" value="45">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Street Light Repair SLA (hours)</label>
                            <input type="number" class="form-control" value="24">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Power Supply Restoration (hours)</label>
                            <input type="number" class="form-control" value="8">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Communication -->
            <div class="page" id="deptCommunication">
                <div class="page-header">
                    <h2>Communication Hub</h2>
                    <button class="btn btn--sm btn--primary">New Message</button>
                </div>

                <div class="communication-tabs">
                    <button class="tab-btn active" data-tab="internal">TANGEDCO Internal</button>
                    <button class="tab-btn" data-tab="citizens">Citizens</button>
                    <button class="tab-btn" data-tab="whatsapp">WhatsApp Updates</button>
                </div>

                <div class="tab-content active" id="internal">
                    <div class="message-list">
                        <div class="message-item urgent">
                            <div class="message-header">
                                <strong>Dr. S. Muralidharan - SE Chennai EDC</strong>
                                <span class="message-time">30 min ago</span>
                            </div>
                            <p>Priority alert: Multiple transformer overload reports. Need immediate action plan for Ranganathan Street area.</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--primary">Send Report</button>
                            </div>
                        </div>
                        <div class="message-item">
                            <div class="message-header">
                                <strong>AE Ramesh Kumar - Transformer Team</strong>
                                <span class="message-time">2 hours ago</span>
                            </div>
                            <p>Transformer T-NG-15 load testing completed. Requires immediate load balancing. Photos uploaded to system.</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--outline">View Photos</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="citizens">
                    <div class="message-list">
                        <div class="message-item">
                            <div class="message-header">
                                <strong>M. Rajesh (Consumer: 12304567890)</strong>
                                <span class="message-time">1 hour ago</span>
                            </div>
                            <p>Thank you for fixing the street light on Pondy Bazaar. Much appreciated!</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--outline">Send SMS Update</button>
                            </div>
                        </div>
                        <div class="message-item">
                            <div class="message-header">
                                <strong>Shop Owners Association</strong>
                                <span class="message-time">3 hours ago</span>
                            </div>
                            <p>Power cuts affecting business. When will transformer issue be resolved?</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--primary">Send Update</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="whatsapp">
                    <div class="whatsapp-info">
                        <div class="whatsapp-banner">
                            <i class="fab fa-whatsapp"></i>
                            <div class="whatsapp-details">
                                <h4>Chennai TANGEDCO WhatsApp</h4>
                                <p>9445850829 - For photo complaints and updates</p>
                            </div>
                        </div>
                        <div class="whatsapp-stats">
                            <div class="whatsapp-stat">
                                <span class="whatsapp-number">156</span>
                                <span class="whatsapp-label">Messages Today</span>
                            </div>
                            <div class="whatsapp-stat">
                                <span class="whatsapp-number">42</span>
                                <span class="whatsapp-label">Photo Complaints</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Central Authority Views - Chennai Corporation -->
        <div class="view central-view" id="centralView">
            <!-- City Overview -->
            <div class="page active" id="centralOverview">
                <div class="page-header">
                    <h2>Chennai Corporation Dashboard</h2>
                    <p>Citywide Electrical Infrastructure Coordination</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">15</div>
                        <div class="stat-label">EB Offices</div>
                        <div class="stat-change">Under Chennai EDC</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">89%</div>
                        <div class="stat-label">Infrastructure Health</div>
                        <div class="stat-change">+2% this quarter</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">2,156</div>
                        <div class="stat-label">Monthly Complaints</div>
                        <div class="stat-change">-5% from last month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">91%</div>
                        <div class="stat-label">Citizen Satisfaction</div>
                        <div class="stat-change">+1% this month</div>
                    </div>
                </div>

                <div class="department-overview">
                    <h3>Electrical Infrastructure Coordination</h3>
                    <div class="dept-cards">
                        <div class="dept-card electrical">
                            <div class="dept-header">
                                <h4>TANGEDCO Chennai EDC</h4>
                                <span class="dept-status good">87% SLA</span>
                            </div>
                            <div class="dept-stats">
                                <div class="dept-stat">
                                    <span class="dept-number">169</span>
                                    <span class="dept-label">Pending</span>
                                </div>
                                <div class="dept-stat">
                                    <span class="dept-number">1.8</span>
                                    <span class="dept-label">Avg Days</span>
                                </div>
                            </div>
                            <div class="dept-details">
                                <span><i class="fas fa-bolt"></i> Electrical Supply & Distribution</span>
                            </div>
                        </div>

                        <div class="dept-card coordination">
                            <div class="dept-header">
                                <h4>Roads & Infrastructure</h4>
                                <span class="dept-status good">84% SLA</span>
                            </div>
                            <div class="dept-stats">
                                <div class="dept-stat">
                                    <span class="dept-number">45</span>
                                    <span class="dept-label">Coord. Issues</span>
                                </div>
                                <div class="dept-stat">
                                    <span class="dept-number">2.1</span>
                                    <span class="dept-label">Avg Days</span>
                                </div>
                            </div>
                            <div class="dept-details">
                                <span><i class="fas fa-road"></i> Electric pole installations, Street lighting</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="overviewChart"></canvas>
                </div>
            </div>

            <!-- Inter-Department -->
            <div class="page" id="centralInterDept">
                <div class="page-header">
                    <h2>Inter-Department Coordination</h2>
                </div>

                <div class="cross-dept-stats">
                    <div class="cross-stat">
                        <span class="cross-number">12</span>
                        <span class="cross-label">Electrical Coord.</span>
                    </div>
                    <div class="cross-stat">
                        <span class="cross-number">8</span>
                        <span class="cross-label">Infrastructure</span>
                    </div>
                    <div class="cross-stat">
                        <span class="cross-number">3</span>
                        <span class="cross-label">Emergency</span>
                    </div>
                </div>

                <div class="cross-dept-issues">
                    <div class="cross-issue-card electrical">
                        <div class="issue-header">
                            <div class="issue-id">#CE001</div>
                            <div class="issue-priority critical">Emergency</div>
                        </div>
                        <h4>Cable Damage from Road Construction</h4>
                        <p>Underground cable damaged during road widening work on Anna Salai. Power cut affecting commercial area.</p>
                        <div class="involved-depts">
                            <span class="dept-tag electrical">TANGEDCO</span>
                            <span class="dept-tag infrastructure">Roads Dept</span>
                        </div>
                        <div class="issue-actions">
                            <button class="btn btn--sm btn--primary">Coordinate</button>
                            <button class="btn btn--sm btn--outline">Emergency Response</button>
                        </div>
                    </div>

                    <div class="cross-issue-card electrical">
                        <div class="issue-header">
                            <div class="issue-id">#CE002</div>
                            <div class="issue-priority high">High</div>
                        </div>
                        <h4>Street Light Installation - New Development</h4>
                        <p>New residential development requires street lighting infrastructure coordination with electrical connections.</p>
                        <div class="involved-depts">
                            <span class="dept-tag electrical">TANGEDCO</span>
                            <span class="dept-tag infrastructure">Corporation</span>
                            <span class="dept-tag planning">Planning</span>
                        </div>
                        <div class="issue-actions">
                            <button class="btn btn--sm btn--primary">Plan Meeting</button>
                            <button class="btn btn--sm btn--outline">View Project</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Planning -->
            <div class="page" id="centralPlanning">
                <div class="page-header">
                    <h2>Infrastructure Planning</h2>
                </div>

                <div class="planning-sections">
                    <div class="planning-section">
                        <h3>Electrical Infrastructure Development</h3>
                        <div class="planning-projects">
                            <div class="project-card">
                                <h4>Smart Grid Implementation - Phase 1</h4>
                                <p>Digital transformation of electrical distribution in T Nagar and Mylapore areas.</p>
                                <div class="project-meta">
                                    <span><i class="fas fa-calendar"></i> Q4 2025 - Q2 2026</span>
                                    <span><i class="fas fa-rupee-sign"></i> ₹45 Crores</span>
                                </div>
                                <div class="project-status">
                                    <span class="status status--info">Planning Phase</span>
                                </div>
                            </div>
                            
                            <div class="project-card">
                                <h4>LED Street Light Upgrade</h4>
                                <p>Complete LED conversion for energy efficiency and smart lighting controls.</p>
                                <div class="project-meta">
                                    <span><i class="fas fa-calendar"></i> Q1 2025 - Q3 2025</span>
                                    <span><i class="fas fa-rupee-sign"></i> ₹12 Crores</span>
                                </div>
                                <div class="project-status">
                                    <span class="status status--warning">In Progress</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="planning-section">
                        <h3>Budget Allocation - Electrical Works</h3>
                        <div class="budget-breakdown">
                            <div class="budget-item">
                                <span class="budget-category">Emergency Repairs</span>
                                <span class="budget-allocated">₹8.5 Cr</span>
                                <span class="budget-utilized">₹6.2 Cr (73%)</span>
                            </div>
                            <div class="budget-item">
                                <span class="budget-category">Infrastructure Upgrade</span>
                                <span class="budget-allocated">₹25 Cr</span>
                                <span class="budget-utilized">₹18.7 Cr (75%)</span>
                            </div>
                            <div class="budget-item">
                                <span class="budget-category">New Connections</span>
                                <span class="budget-allocated">₹12 Cr</span>
                                <span class="budget-utilized">₹9.8 Cr (82%)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports -->
            <div class="page" id="centralReports">
                <div class="page-header">
                    <h2>Electrical Service Reports</h2>
                </div>

                <div class="report-sections">
                    <div class="report-section">
                        <h3>TANGEDCO Performance Reports</h3>
                        <div class="report-list">
                            <div class="report-item electrical">
                                <div class="report-info">
                                    <h4>Monthly Electrical Performance Report</h4>
                                    <p>Comprehensive analysis of power supply quality, outage statistics, and customer satisfaction.</p>
                                    <span class="report-meta">Generated: Sept 20, 2025 | Chennai EDC Circle</span>
                                </div>
                                <button class="btn btn--sm btn--outline">Download PDF</button>
                            </div>
                            
                            <div class="report-item electrical">
                                <div class="report-info">
                                    <h4>Street Lighting Performance Report</h4>
                                    <p>LED conversion progress, energy savings, and maintenance statistics across all zones.</p>
                                    <span class="report-meta">Generated: Sept 20, 2025 | All EB Offices</span>
                                </div>
                                <button class="btn btn--sm btn--outline">Download PDF</button>
                            </div>
                            
                            <div class="report-item electrical">
                                <div class="report-info">
                                    <h4>Power Quality Assessment</h4>
                                    <p>Voltage stability, frequency variations, and power factor analysis for industrial areas.</p>
                                    <span class="report-meta">Generated: Sept 19, 2025 | Technical Assessment</span>
                                </div>
                                <button class="btn btn--sm btn--outline">Download PDF</button>
                            </div>
                        </div>
                    </div>

                    <div class="report-section">
                        <h3>Custom Electrical Reports</h3>
                        <div class="custom-report-form">
                            <div class="form-group">
                                <label class="form-label">Report Type</label>
                                <select class="form-control">
                                    <option>Complaint Analysis</option>
                                    <option>Infrastructure Health</option>
                                    <option>Energy Consumption</option>
                                    <option>Service Quality Metrics</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Coverage Area</label>
                                <select class="form-control">
                                    <option>Entire Chennai EDC</option>
                                    <option>T Nagar EB Office</option>
                                    <option>Mylapore EB Office</option>
                                    <option>Adyar EB Office</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date Range</label>
                                <select class="form-control">
                                    <option>Last 30 days</option>
                                    <option>Last 3 months</option>
                                    <option>Last 6 months</option>
                                    <option>Custom range</option>
                                </select>
                            </div>
                            <button class="btn btn--primary">Generate Electrical Report</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin -->
            <div class="page" id="centralAdmin">
                <div class="page-header">
                    <h2>Electrical System Administration</h2>
                </div>

                <div class="settings-sections">
                    <div class="settings-section">
                        <h3>TANGEDCO Integration</h3>
                        <div class="setting-item">
                            <span>Real-time data sync with TANGEDCO servers</span>
                            <label class="toggle">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Automatic complaint routing to EB offices</span>
                            <label class="toggle">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>WhatsApp complaint integration</span>
                            <label class="toggle">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Electrical System Users</h3>
                        <div class="user-stats">
                            <div class="user-stat">
                                <span class="user-count">89</span>
                                <span class="user-label">EB Office Staff</span>
                            </div>
                            <div class="user-stat">
                                <span class="user-count">15</span>
                                <span class="user-label">Assistant Engineers</span>
                            </div>
                            <div class="user-stat">
                                <span class="user-count">23</span>
                                <span class="user-label">Field Technicians</span>
                            </div>
                        </div>
                        <button class="btn btn--primary">Manage TANGEDCO Users</button>
                    </div>
                </div>
            </div>

            <!-- Communication -->
            <div class="page" id="centralCommunication">
                <div class="page-header">
                    <h2>Communication Hub</h2>
                    <button class="btn btn--sm btn--primary">New Message</button>
                </div>

                <div class="communication-tabs">
                    <button class="tab-btn active" data-tab="internal">TANGEDCO Internal</button>
                    <button class="tab-btn" data-tab="citizens">Citizens</button>
                    <button class="tab-btn" data-tab="whatsapp">WhatsApp Updates</button>
                </div>

                <div class="tab-content active" id="internal">
                    <div class="message-list">
                        <div class="message-item urgent">
                            <div class="message-header">
                                <strong>Dr. S. Muralidharan - SE Chennai EDC</strong>
                                <span class="message-time">30 min ago</span>
                            </div>
                            <p>Priority alert: Multiple transformer overload reports. Need immediate action plan for Ranganathan Street area.</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--primary">Send Report</button>
                            </div>
                        </div>
                        <div class="message-item">
                            <div class="message-header">
                                <strong>AE Ramesh Kumar - Transformer Team</strong>
                                <span class="message-time">2 hours ago</span>
                            </div>
                            <p>Transformer T-NG-15 load testing completed. Requires immediate load balancing. Photos uploaded to system.</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--outline">View Photos</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="citizens">
                    <div class="message-list">
                        <div class="message-item">
                            <div class="message-header">
                                <strong>M. Rajesh (Consumer: 12304567890)</strong>
                                <span class="message-time">1 hour ago</span>
                            </div>
                            <p>Thank you for fixing the street light on Pondy Bazaar. Much appreciated!</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--outline">Send SMS Update</button>
                            </div>
                        </div>
                        <div class="message-item">
                            <div class="message-header">
                                <strong>Shop Owners Association</strong>
                                <span class="message-time">3 hours ago</span>
                            </div>
                            <p>Power cuts affecting business. When will transformer issue be resolved?</p>
                            <div class="message-actions">
                                <button class="btn btn--sm btn--outline">Reply</button>
                                <button class="btn btn--sm btn--primary">Send Update</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="whatsapp">
                    <div class="whatsapp-info">
                        <div class="whatsapp-banner">
                            <i class="fab fa-whatsapp"></i>
                            <div class="whatsapp-details">
                                <h4>Chennai TANGEDCO WhatsApp</h4>
                                <p>9445850829 - For photo complaints and updates</p>
                            </div>
                        </div>
                        <div class="whatsapp-stats">
                            <div class="whatsapp-stat">
                                <span class="whatsapp-number">156</span>
                                <span class="whatsapp-label">Messages Today</span>
                            </div>
                            <div class="whatsapp-stat">
                                <span class="whatsapp-number">42</span>
                                <span class="whatsapp-label">Photo Complaints</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" id="bottomNav">
        <!-- Local Unit Navigation - T Nagar EB Office -->
        <div class="nav-items local-nav active" id="localNav">
            <button class="nav-item active" data-page="localDashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </button>
            <button class="nav-item" data-page="localComplaints">
                <i class="fas fa-bolt"></i>
                <span>Complaints</span>
            </button>
            <button class="nav-item" data-page="localFieldWork">
                <i class="fas fa-hard-hat"></i>
                <span>Field Work</span>
            </button>
            <button class="nav-item" data-page="localCommunication">
                <i class="fas fa-comments"></i>
                <span>Chat</span>
            </button>
            <button class="nav-item" data-page="localProfile">
                <i class="fas fa-user-tie"></i>
                <span>Profile</span>
            </button>
        </div>

        <!-- Department Board Navigation - TANGEDCO Chennai EDC -->
        <div class="nav-items department-nav nav-items-6" id="departmentNav">
            <button class="nav-item active" data-page="deptAnalytics">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </button>
            <button class="nav-item" data-page="deptLive">
                <i class="fas fa-wifi"></i>
                <span>Live Monitor</span>
            </button>
            <button class="nav-item" data-page="deptPerformance">
                <i class="fas fa-trophy"></i>
                <span>Performance</span>
            </button>
            <button class="nav-item" data-page="deptCommunication">
                <i class="fas fa-comments"></i>
                <span>Chat</span>
            </button>
            <button class="nav-item" data-page="deptTerritory">
                <i class="fas fa-map-marked-alt"></i>
                <span>Territory</span>
            </button>
            <button class="nav-item" data-page="deptSettings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </div>

        <!-- Central Authority Navigation - Chennai Corporation -->
        <div class="nav-items central-nav nav-items-6" id="centralNav">
            <button class="nav-item active" data-page="centralOverview">
                <i class="fas fa-city"></i>
                <span>City Overview</span>
            </button>
            <button class="nav-item" data-page="centralInterDept">
                <i class="fas fa-handshake"></i>
                <span>Inter-Dept</span>
            </button>
            <button class="nav-item" data-page="centralPlanning">
                <i class="fas fa-drafting-compass"></i>
                <span>Planning</span>
            </button>
            <button class="nav-item" data-page="centralCommunication">
                <i class="fas fa-comments"></i>
                <span>Chat</span>
            </button>
            <button class="nav-item" data-page="centralReports">
                <i class="fas fa-file-alt"></i>
                <span>Reports</span>
            </button>
            <button class="nav-item" data-page="centralAdmin">
                <i class="fas fa-tools"></i>
                <span>Admin</span>
            </button>
        </div>
    </nav>

    <!-- Modals and overlays -->
    <div id="modalOverlay" class="modal-overlay hidden"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="app.js"></script> -->
    <script>

        // TANGEDCO Electrical Complaint Management System - JavaScript

class ElectricalComplaintApp {
    constructor() {
        this.currentRole = 'local';
        this.currentPage = {
            local: 'localDashboard',
            department: 'deptAnalytics', 
            central: 'centralOverview'
        };
        this.charts = {};
        this.notifications = 3;
        this.liveUpdateInterval = null;
        
        // Electrical complaint data from the provided JSON
        this.data = {
            complaints: [
                {
                    id: "TNE2025001",
                    title: "Street Light Not Working - Pondy Bazaar",
                    description: "Street light pole number PB-45 on Pondy Bazaar main road has been non-functional for 4 days. LED bulb seems damaged. Causing safety issues for shoppers and pedestrians during evening hours.",
                    location: "Pondy Bazaar, T Nagar",
                    coordinates: { lat: 13.0417, lng: 80.2343 },
                    landmark: "Near Saravana Bhavan Restaurant",
                    poleNumber: "PB-45",
                    status: "Work Order Issued",
                    priority: "High",
                    category: "Street Light Maintenance",
                    subCategory: "LED Bulb Replacement",
                    department: "T Nagar EB Office",
                    reportedBy: "M. Rajesh",
                    reporterPhone: "+91 9876543210",
                    consumerNumber: "12304567890",
                    createdDate: "2025-09-18T10:30:00Z",
                    assignedTo: "AE Subramanian (Field Team-1)",
                    workOrderNumber: "WO/TNE/2025/0045",
                    estimatedCost: 450,
                    images: ["streetlight_pondy1.jpg", "pole_pb45.jpg"],
                    upvotes: 23,
                    comments: 5,
                    faultType: "Infrastructure",
                    urgencyLevel: "Medium"
                },
                {
                    id: "TNE2025002",
                    title: "Frequent Power Cuts - Ranganathan Street",
                    description: "Experiencing 3-4 hour power cuts daily for the past week. Multiple households and shops affected. Transformer T-NG-15 seems to be overloading during peak hours.",
                    location: "Ranganathan Street, T Nagar", 
                    coordinates: { lat: 13.0428, lng: 80.2341 },
                    landmark: "Near Naidu Hall",
                    transformerNumber: "T-NG-15",
                    status: "In Progress",
                    priority: "Critical",
                    category: "Power Supply Issue",
                    subCategory: "Transformer Overload",
                    department: "T Nagar EB Office",
                    reportedBy: "Shop Owners Association",
                    reporterPhone: "+91 9123456789",
                    createdDate: "2025-09-19T08:15:00Z",
                    assignedTo: "AE Ramesh Kumar (Transformer Team)",
                    workOrderNumber: "WO/TNE/2025/0046",
                    estimatedCost: 15000,
                    images: ["transformer_t_ng_15.jpg", "overload_damage.jpg"],
                    upvotes: 67,
                    comments: 18,
                    faultType: "Equipment Failure",
                    urgencyLevel: "High",
                    affectedConsumers: 120
                },
                {
                    id: "TNE2025003",
                    title: "Meter Reading Error - Habibullah Road",
                    description: "Electricity meter showing abnormally high consumption (1200 units) this month compared to usual 300 units. No change in usage pattern. Requesting meter testing.",
                    location: "Habibullah Road, T Nagar",
                    coordinates: { lat: 13.0401, lng: 80.2298 },
                    landmark: "Near Joyalukkas Showroom", 
                    meterNumber: "HB4501234",
                    status: "Verified",
                    priority: "Medium",
                    category: "Meter Related",
                    subCategory: "Billing Dispute",
                    department: "T Nagar EB Office",
                    reportedBy: "Mrs. Lakshmi Devi",
                    reporterPhone: "+91 9876512345",
                    consumerNumber: "45012340567",
                    createdDate: "2025-09-20T14:20:00Z",
                    assignedTo: "Meter Reader - Kumar",
                    previousReading: 15240,
                    currentReading: 16440,
                    averageMonthlyUsage: 300,
                    images: ["meter_hb4501234.jpg", "bill_comparison.jpg"],
                    upvotes: 8,
                    comments: 3,
                    faultType: "Billing Issue",
                    urgencyLevel: "Low"
                },
                {
                    id: "TNE2025004", 
                    title: "Voltage Fluctuation - Usman Road",
                    description: "Severe voltage fluctuations causing damage to appliances. Voltage dropping to 180V during evening peak hours. Multiple complaints from nearby consumers.",
                    location: "Usman Road, T Nagar",
                    coordinates: { lat: 13.0445, lng: 80.2387 },
                    landmark: "Near Spencer Plaza",
                    status: "Open",
                    priority: "High", 
                    category: "Power Quality",
                    subCategory: "Voltage Fluctuation",
                    department: "T Nagar EB Office",
                    reportedBy: "Apartment Association",
                    reporterPhone: "+91 9234567890",
                    createdDate: "2025-09-17T09:45:00Z",
                    assignedTo: null,
                    affectedArea: "Usman Road (200m stretch)",
                    images: ["voltage_meter.jpg", "damaged_appliance.jpg"],
                    upvotes: 45,
                    comments: 12,
                    faultType: "Power Quality",
                    urgencyLevel: "High",
                    affectedConsumers: 85
                },
                {
                    id: "TNE2025005",
                    title: "Cable Spark Near Bus Stop",
                    description: "Overhead cable sparking near T Nagar bus stop. Safety hazard for commuters. Cable insulation damaged due to tree branch contact.",
                    location: "T Nagar Bus Stop",
                    coordinates: { lat: 13.0427, lng: 80.2345 },
                    landmark: "T Nagar Bus Terminus",
                    status: "Resolved", 
                    priority: "Emergency",
                    category: "Safety Hazard",
                    subCategory: "Cable Damage",
                    department: "T Nagar EB Office",
                    reportedBy: "Bus Conductor - Murugan",
                    reporterPhone: "+91 9345678901",
                    createdDate: "2025-09-15T11:30:00Z",
                    resolvedDate: "2025-09-15T16:45:00Z",
                    assignedTo: "Emergency Response Team",
                    workOrderNumber: "WO/TNE/2025/0044",
                    images: ["cable_spark1.jpg", "cable_repaired.jpg", "safety_clearance.jpg"],
                    upvotes: 92,
                    comments: 21,
                    faultType: "Safety Emergency",
                    urgencyLevel: "Emergency",
                    resolutionTime: "5 hours 15 minutes"
                },
                {
                    id: "TNE2025006",
                    title: "New Service Connection Request",
                    description: "New commercial establishment requires 10KW 3-phase connection for textile showroom. All documents submitted, waiting for site inspection.",
                    location: "GN Chetty Road, T Nagar",
                    coordinates: { lat: 13.0423, lng: 80.2378 },
                    landmark: "Near Malar Hospital",
                    status: "Inspection Scheduled",
                    priority: "Medium",
                    category: "Service Connection",
                    subCategory: "New Connection",
                    department: "T Nagar EB Office",
                    reportedBy: "K. Selvam - Business Owner",
                    reporterPhone: "+91 9567890123",
                    createdDate: "2025-09-16T10:00:00Z",
                    assignedTo: "AE Inspection Team",
                    requiredLoad: "10 KW",
                    connectionType: "3-Phase Commercial",
                    applicationNumber: "NC/TN/2025/0156",
                    inspectionDate: "2025-09-23T10:00:00Z",
                    images: ["shop_front.jpg", "documents.jpg"],
                    upvotes: 3,
                    comments: 1,
                    faultType: "Service Request",
                    urgencyLevel: "Low"
                }
            ],
            staff: [
                {
                    name: "V. Subramanian",
                    designation: "Assistant Engineer/O&M",
                    department: "T Nagar EB Office",
                    empId: "TNE001",
                    phone: "+91 9445850123",
                    email: "ae.tnagar@tnebnet.org",
                    specialization: "Street Lighting & Distribution",
                    experience: "12 years",
                    currentAssignments: 8,
                    area: "Pondy Bazaar, Ranganathan Street"
                },
                {
                    name: "R. Ramesh Kumar",
                    designation: "Assistant Engineer/Transformer",
                    department: "T Nagar EB Office", 
                    empId: "TNE002",
                    phone: "+91 9445850124",
                    email: "ae.transformer.tnagar@tnebnet.org",
                    specialization: "Transformer Maintenance",
                    experience: "15 years",
                    currentAssignments: 5,
                    area: "Usman Road, Habibullah Road"
                },
                {
                    name: "Dr. S. Muralidharan",
                    designation: "Superintending Engineer",
                    department: "Chennai EDC/Central",
                    empId: "CEC001",
                    phone: "+91 9445857001",
                    email: "se.chennaicentral@tnebnet.org",
                    specialization: "Distribution Circle Management",
                    experience: "22 years",
                    jurisdiction: "Central Chennai Circle",
                    officesUnder: 15
                }
            ],
            infrastructure: {
                tNagarArea: {
                    transformers: [
                        {"id": "T-NG-15", "location": "Ranganathan Street", "capacity": "250 KVA", "status": "Overloaded"},
                        {"id": "T-NG-23", "location": "Pondy Bazaar", "capacity": "400 KVA", "status": "Normal"},
                        {"id": "T-NG-08", "location": "Usman Road", "capacity": "315 KVA", "status": "Maintenance Due"}
                    ],
                    streetLights: {
                        total: 245,
                        functional: 221,
                        needRepair: 24,
                        ledUpgraded: 180,
                        traditionalBulbs: 65
                    },
                    serviceConnections: {
                        domestic: 12450,
                        commercial: 2340,
                        industrial: 45,
                        streetLighting: 245
                    }
                }
            },
            performance: {
                tNagarOffice: {
                    monthlyComplaints: 186,
                    resolved: 164,
                    pending: 22,
                    avgResolutionTime: "18 hours",
                    customerSatisfaction: "91%",
                    emergencyResponseTime: "45 minutes"
                },
                chennaiEDC: {
                    totalComplaints: 2156,
                    resolved: 1987,
                    pending: 169,
                    avgResolutionTime: "1.8 days",
                    slaCompliance: "87%",
                    officesUnderJurisdiction: 15
                }
            },
            emergencyContacts: {
                focCenter: "1912",
                consumerCallCenter: "9498794987", 
                whatsappChennai: "9445850829",
                tNagarOffice: "044-2434-1101",
                emergencyRepair: "9445850811"
            }
        };

        this.init();
    }

    init() {
        this.setupEventListeners();
        this.updateHeader();
    this.renderElectricalComplaints();
        this.startRealTimeUpdates();
        
        // Initialize charts after DOM is ready
        setTimeout(() => {
            this.setupElectricalCharts();
        }, 500);
        
        // Show role switcher
        this.showRoleSwitcher();
        
        console.log('TANGEDCO Electrical Complaint Management System initialized');
    }

    showRoleSwitcher() {
        const roleSwitcher = document.getElementById('roleSwitcher');
        if (roleSwitcher) {
            roleSwitcher.style.display = 'block';
            roleSwitcher.style.opacity = '1';
        }
    }

    setupEventListeners() {
        // Role switcher
        const roleSelect = document.getElementById('roleSelect');
        if (roleSelect) {
            roleSelect.addEventListener('change', (e) => {
                this.switchRole(e.target.value);
            });
        }

        // Global click handler with event delegation
        document.addEventListener('click', (e) => {
            this.handleGlobalClick(e);
        });
        
        // Search functionality
        const searchInput = document.getElementById('complaintSearch');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.filterElectricalComplaints(e.target.value);
            });
        }

        // Filter functionality
        const categoryFilter = document.getElementById('categoryFilter');
        const statusFilter = document.getElementById('statusFilter');
        
        if (categoryFilter) {
            categoryFilter.addEventListener('change', () => this.applyElectricalFilters());
        }
        
        if (statusFilter) {
            statusFilter.addEventListener('change', () => this.applyElectricalFilters());
        }

        // Settings toggles
        document.addEventListener('change', (e) => {
            if (e.target.matches('.toggle input')) {
                this.handleElectricalSetting(e.target);
            }
        });

        // Keyboard shortcuts for electrical emergency
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                this.showEmergencyPanel();
            }
        });
    }

    handleGlobalClick(e) {
        // Navigation items
        if (e.target.closest('.nav-item')) {
            const navItem = e.target.closest('.nav-item');
            const page = navItem.dataset.page;
            if (page) {
                e.preventDefault();
                this.navigateToPage(page);
            }
            return;
        }

        // Complaint cards
        if (e.target.closest('.complaint-card')) {
            const card = e.target.closest('.complaint-card');
            const complaintId = this.getComplaintIdFromCard(card);
            if (complaintId && !e.target.closest('.btn')) {
                this.showElectricalComplaintDetails(complaintId);
            }
            return;
        }

        // Work order cards
        if (e.target.closest('.work-order-card')) {
            const card = e.target.closest('.work-order-card');
            const workOrderId = card.querySelector('.work-order-id')?.textContent;
            if (workOrderId && !e.target.closest('.btn')) {
                this.showWorkOrderDetails(workOrderId);
            }
            return;
        }

        // Tab buttons
        if (e.target.closest('.tab-btn')) {
            const button = e.target.closest('.tab-btn');
            this.switchTab(button);
            return;
        }

        // Button clicks
        if (e.target.closest('.btn')) {
            const button = e.target.closest('.btn');
            this.handleElectricalButtonClick(button, e);
            return;
        }

        // Emergency banner
        if (e.target.closest('.emergency-banner')) {
            this.showEmergencyContacts();
            return;
        }

        // Notification button
        if (e.target.closest('#notificationBtn')) {
            this.showElectricalNotifications();
            return;
        }

        // Office items
        if (e.target.closest('.office-item')) {
            const officeName = e.target.closest('.office-item').querySelector('.office-name').textContent;
            this.showOfficeDetails(officeName);
            return;
        }

        // Infrastructure items
        if (e.target.closest('.infra-item')) {
            const infraType = e.target.closest('.infra-item').querySelector('.infra-name').textContent;
            this.showInfrastructureDetails(infraType);
            return;
        }
    }

    getComplaintIdFromCard(card) {
        // Try to get complaint ID from various possible sources
        const idElement = card.querySelector('.complaint-id');
        if (idElement) {
            return idElement.textContent.trim();
        }
        
        // Fallback to data attribute if available
        return card.dataset.complaintId;
    }

    switchRole(role) {
        console.log(`Switching to role: ${role}`);
        this.currentRole = role;
        
        // Hide all views and nav items
        document.querySelectorAll('.view').forEach(view => {
            view.classList.remove('active');
        });
        document.querySelectorAll('.nav-items').forEach(nav => {
            nav.classList.remove('active');
        });
        
        // Show selected view and nav
        const targetView = document.getElementById(`${role}View`);
        const targetNav = document.getElementById(`${role}Nav`);
        
        if (targetView) {
            targetView.classList.add('active');
        }
        
        if (targetNav) {
            targetNav.classList.add('active');
        }
        
        // Update header for electrical context
        this.updateElectricalHeader();
        
        // Navigate to default page for this role
        this.navigateToPage(this.currentPage[role]);
        
        // Setup role-specific features
        setTimeout(() => {
            this.setupElectricalCharts();
            this.updateRoleSpecificData();
        }, 200);
    }

    updateElectricalHeader() {
        const headerTitle = document.getElementById('headerTitle');
        const headerSubtitle = document.getElementById('headerSubtitle');
        
        const electricalTitles = {
            local: { 
                title: 'T Nagar EB Office', 
                subtitle: 'Assistant Engineer - TANGEDCO'
            },
            department: { 
                title: 'TANGEDCO Chennai EDC', 
                subtitle: 'Superintending Engineer - Distribution Circle'
            },
            central: { 
                title: 'Chennai Corporation', 
                subtitle: 'Electrical Infrastructure Coordination'
            }
        };
        
        const config = electricalTitles[this.currentRole];
        if (headerTitle) headerTitle.textContent = config.title;
        if (headerSubtitle) headerSubtitle.textContent = config.subtitle;
    }

    navigateToPage(pageId) {
        console.log(`Navigating to page: ${pageId}`);
        
        // Hide all pages in current view
        const currentView = document.querySelector(`.view.active`);
        if (currentView) {
            currentView.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            const targetPage = currentView.querySelector(`#${pageId}`);
            if (targetPage) {
                targetPage.classList.add('active');
            }
        }
        
        // Update navigation active state
        const currentNav = document.querySelector('.nav-items.active');
        if (currentNav) {
            currentNav.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const targetNavItem = currentNav.querySelector(`[data-page="${pageId}"]`);
            if (targetNavItem) {
                targetNavItem.classList.add('active');
            }
        }
        
        // Update current page for this role
        this.currentPage[this.currentRole] = pageId;
        
        // Setup page-specific electrical features
        this.setupElectricalPageFeatures(pageId);
    }

    setupElectricalPageFeatures(pageId) {
        switch (pageId) {
            case 'localComplaints':
                this.renderElectricalComplaints();
                break;
            case 'localFieldWork':
                this.updateFieldWorkData();
                break;
            case 'deptAnalytics':
            case 'deptPerformance':
            case 'centralOverview':
                setTimeout(() => this.setupElectricalCharts(), 100);
                break;
            case 'deptLive':
                this.setupElectricalLiveUpdates();
                break;
            case 'localCommunication':
                this.updateWhatsAppStats();
                break;
            case 'localProfile':
                this.updateEngineerProfile();
                break;
        }
    }

    switchTab(button) {
        const tabName = button.dataset.tab;
        const parent = button.closest('.page');
        
        if (!parent || !tabName) return;
        
        // Update tab buttons
        parent.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        button.classList.add('active');
        
        // Update tab content
        parent.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        
        const targetContent = parent.querySelector(`#${tabName}`);
        if (targetContent) {
            targetContent.classList.add('active');
        }
    }

    renderElectricalComplaints() {
    const tbody = document.getElementById('complaintsTableBody');
    if (!tbody) return;

    tbody.innerHTML = ''; // clear existing rows

    this.data.complaints.forEach(complaint => {
        const row = this.createElectricalComplaintRow(complaint);
        tbody.appendChild(row);
    });
}

createElectricalComplaintRow(complaint) {
    const row = document.createElement('tr');
    row.className = `complaint-row electrical priority-${complaint.priority.toLowerCase()}`;
    row.dataset.complaintId = complaint.id;

    const timeAgo = this.getTimeAgo(complaint.createdDate);
    const statusClass = this.getElectricalStatusClass(complaint.status);

    row.innerHTML = `
        <td class="complaint-id">${complaint.id}</td>
        <td class="complaint-issue">
            <strong>${complaint.title}</strong>
            <br><small>${complaint.description}</small>
        </td>
        <td>
            <i class="fas fa-map-marker-alt"></i> ${complaint.location}
            <br><small>${timeAgo}</small>
        </td>
        <td><span class="category-tag ${complaint.category.toLowerCase()}">${complaint.category}</span></td>
        <td><span class="priority-badge ${complaint.priority.toLowerCase()}">${complaint.priority}</span></td>
        <td><span class="status ${statusClass}">${complaint.status}</span></td>
        <td>
            <button class="btn btn--sm btn--primary">Assign</button>
            <button class="btn btn--sm btn--outline">View</button>
        </td>
    `;

    return row;
}


    createElectricalComplaintActions(complaint) {
        return `
            <div class="complaint-actions" style="margin-top: 12px; display: flex; gap: 8px; justify-content: flex-end;">
                <button class="btn btn--sm btn--primary" data-action="view" data-complaint="${complaint.id}">View Details</button>
                <button class="btn btn--sm btn--outline" data-action="update" data-complaint="${complaint.id}">Update Status</button>
                ${complaint.priority === 'Emergency' ? '<button class="btn btn--sm btn--emergency" data-action="emergency" data-complaint="' + complaint.id + '">Emergency Response</button>' : ''}
            </div>
        `;
    }

    getElectricalStatusClass(status) {
        const statusMap = {
            'Open': 'status--warning',
            'Verified': 'status--info',
            'Work Order Issued': 'status--info',
            'In Progress': 'status--warning',
            'Testing': 'status--info',
            'Resolved': 'status--success',
            'Closed': 'status--success',
            'Inspection Scheduled': 'status--info'
        };
        return statusMap[status] || 'status--info';
    }

    setupElectricalCharts() {
        if (typeof Chart === 'undefined') {
            console.log('Chart.js not loaded yet, retrying...');
            setTimeout(() => this.setupElectricalCharts(), 500);
            return;
        }

        // Department Analytics Chart - Electrical Performance
        const deptChartCanvas = document.getElementById('deptChart');
        if (deptChartCanvas && this.currentRole === 'department') {
            if (this.charts.deptChart) {
                this.charts.deptChart.destroy();
            }
            
            const ctx = deptChartCanvas.getContext('2d');
            this.charts.deptChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                    datasets: [{
                        label: 'Electrical Complaints',
                        data: [78, 65, 89, 92, 76, 88, 95, 82, 86],
                        borderColor: '#1FB8CD',
                        backgroundColor: 'rgba(31, 184, 205, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Resolved',
                        data: [72, 61, 84, 87, 71, 83, 89, 78, 81],
                        borderColor: '#B4413C',
                        backgroundColor: 'rgba(180, 65, 60, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Emergency Response',
                        data: [5, 8, 3, 6, 9, 4, 7, 5, 3],
                        borderColor: '#D2BA4C',
                        backgroundColor: 'rgba(210, 186, 76, 0.1)',
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'TANGEDCO Electrical Complaint Trends'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Complaints'
                            }
                        }
                    }
                }
            });
        }

        // Performance Chart - Electrical KPIs
        const performanceChartCanvas = document.getElementById('performanceChart');
        if (performanceChartCanvas && this.currentRole === 'department') {
            if (this.charts.performanceChart) {
                this.charts.performanceChart.destroy();
            }
            
            const ctx = performanceChartCanvas.getContext('2d');
            this.charts.performanceChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Power Quality', 'Response Time', 'Customer Satisfaction', 'Infrastructure Health', 'Safety Compliance', 'Energy Efficiency'],
                    datasets: [{
                        label: 'Current Performance',
                        data: [87.5, 92, 91, 89, 95, 88],
                        borderColor: '#1FB8CD',
                        backgroundColor: 'rgba(31, 184, 205, 0.2)',
                        borderWidth: 2
                    }, {
                        label: 'Target',
                        data: [90, 95, 92, 92, 98, 90],
                        borderColor: '#B4413C',
                        backgroundColor: 'rgba(180, 65, 60, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Electrical Service Performance Metrics'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            });
        }

        // Overview Chart for Central Authority - Electrical Infrastructure
        const overviewChartCanvas = document.getElementById('overviewChart');
        if (overviewChartCanvas && this.currentRole === 'central') {
            if (this.charts.overviewChart) {
                this.charts.overviewChart.destroy();
            }
            
            const ctx = overviewChartCanvas.getContext('2d');
            this.charts.overviewChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Street Lighting', 'Power Supply', 'Transformers', 'Meters', 'Service Connections', 'Safety Issues'],
                    datasets: [{
                        data: [245, 456, 89, 123, 67, 15],
                        backgroundColor: ['#1FB8CD', '#FFC185', '#B4413C', '#ECEBD5', '#5D878F', '#DB4545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Electrical Complaint Distribution by Category'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    }

    filterElectricalComplaints(searchTerm) {
        const cards = document.querySelectorAll('.complaint-card');
        cards.forEach(card => {
            const title = card.querySelector('h4')?.textContent.toLowerCase() || '';
            const description = card.querySelector('p')?.textContent.toLowerCase() || '';
            const location = card.querySelector('.complaint-meta span')?.textContent.toLowerCase() || '';
            const complaintId = card.querySelector('.complaint-id')?.textContent.toLowerCase() || '';
            
            const matches = title.includes(searchTerm.toLowerCase()) ||
                           description.includes(searchTerm.toLowerCase()) ||
                           location.includes(searchTerm.toLowerCase()) ||
                           complaintId.includes(searchTerm.toLowerCase());
            
            card.style.display = matches ? 'block' : 'none';
        });
    }

    applyElectricalFilters() {
        const categoryFilter = document.getElementById('categoryFilter')?.value;
        const statusFilter = document.getElementById('statusFilter')?.value;
        
        const cards = document.querySelectorAll('.complaint-card');
        cards.forEach(card => {
            const complaintId = card.dataset.complaintId;
            const complaint = this.data.complaints.find(c => c.id === complaintId);
            
            if (!complaint) return;
            
            let show = true;
            
            // Category filter mapping
            if (categoryFilter) {
                const categoryMap = {
                    'street-light': 'Street Light',
                    'power-supply': 'Power Supply',
                    'transformer': 'Transformer',
                    'meter': 'Meter',
                    'cable': 'Cable',
                    'service': 'Service'
                };
                
                if (!complaint.category.toLowerCase().includes(categoryMap[categoryFilter]?.toLowerCase() || categoryFilter)) {
                    show = false;
                }
            }
            
            if (statusFilter && complaint.status.toLowerCase().replace(' ', '-') !== statusFilter) {
                show = false;
            }
            
            card.style.display = show ? 'block' : 'none';
        });
    }

    updateFieldWorkData() {
        // Update field work statistics with real data
        const fieldStats = document.querySelectorAll('.field-number');
        if (fieldStats.length >= 3) {
            fieldStats[0].textContent = this.getTodaysActiveWorkOrders();
            fieldStats[1].textContent = this.getEmergencyCalls();
            fieldStats[2].textContent = this.getScheduledWork();
        }
    }

    getTodaysActiveWorkOrders() {
        return this.data.complaints.filter(c => 
            c.workOrderNumber && 
            (c.status === 'In Progress' || c.status === 'Work Order Issued')
        ).length;
    }

    getEmergencyCalls() {
        return this.data.complaints.filter(c => c.priority === 'Emergency').length;
    }

    getScheduledWork() {
        // Mock calculation for scheduled work items
        return 15;
    }

    setupElectricalLiveUpdates() {
        // Clear existing interval
        if (this.liveUpdateInterval) {
            clearInterval(this.liveUpdateInterval);
        }

        // Setup live updates every 30 seconds
        this.liveUpdateInterval = setInterval(() => {
            if (this.currentPage[this.currentRole] === 'deptLive') {
                this.updateElectricalLiveStats();
                this.simulateNewElectricalComplaint();
            }
        }, 30000);
    }

    updateElectricalLiveStats() {
        const liveNumbers = document.querySelectorAll('.live-number');
        liveNumbers.forEach((number, index) => {
            const current = parseInt(number.textContent);
            let change;
            
            switch(index) {
                case 0: // New today
                    change = Math.floor(Math.random() * 2); // 0 or 1
                    break;
                case 1: // In progress
                    change = Math.floor(Math.random() * 3) - 1; // -1, 0, or 1
                    break;
                case 2: // Emergency
                    change = Math.random() > 0.8 ? 1 : 0; // Rarely increase
                    break;
                default:
                    change = 0;
            }
            
            const newValue = Math.max(0, current + change);
            number.textContent = newValue;
        });
    }

    simulateNewElectricalComplaint() {
        if (Math.random() > 0.7) { // 30% chance
            const liveComplaintsList = document.querySelector('.live-complaints-list');
            if (liveComplaintsList) {
                const newComplaint = this.createMockElectricalComplaint();
                liveComplaintsList.insertBefore(newComplaint, liveComplaintsList.firstChild);
                
                // Remove old complaints to keep list manageable
                const complaints = liveComplaintsList.querySelectorAll('.live-complaint');
                if (complaints.length > 5) {
                    liveComplaintsList.removeChild(liveComplaintsList.lastChild);
                }
            }
        }
    }

    createMockElectricalComplaint() {
        const complaints = [
            {
                title: "Street Light Failure - Anna Salai",
                description: "Multiple LED street lights not working near Central Railway Station",
                type: "Street Lighting",
                icon: "fas fa-lightbulb",
                details: "12 lights affected"
            },
            {
                title: "Power Cut - Guindy Area",
                description: "Transformer tripped due to overload during peak hours",
                type: "Power Supply",
                icon: "fas fa-bolt",
                details: "200+ consumers affected"
            },
            {
                title: "Cable Damage - IT Corridor",
                description: "Underground cable damaged during metro construction work",
                type: "Infrastructure",
                icon: "fas fa-exclamation-triangle",
                details: "Safety hazard reported"
            }
        ];
        
        const complaint = complaints[Math.floor(Math.random() * complaints.length)];
        const complaintDiv = document.createElement('div');
        complaintDiv.className = 'live-complaint new electrical';
        
        complaintDiv.innerHTML = `
            <div class="complaint-time">Just now</div>
            <h4>${complaint.title}</h4>
            <p>${complaint.description}</p>
            <div class="electrical-details">
                <span><i class="${complaint.icon}"></i> ${complaint.type}</span>
                <span><i class="fas fa-info-circle"></i> ${complaint.details}</span>
            </div>
            <div class="complaint-actions">
                <button class="btn btn--sm btn--primary">Assign Engineer</button>
                <button class="btn btn--sm btn--outline">View Details</button>
            </div>
        `;
        
        return complaintDiv;
    }

    updateWhatsAppStats() {
        const whatsappNumbers = document.querySelectorAll('.whatsapp-number');
        if (whatsappNumbers.length >= 2) {
            // Simulate daily WhatsApp activity
            whatsappNumbers[0].textContent = Math.floor(Math.random() * 50) + 100; // Messages
            whatsappNumbers[1].textContent = Math.floor(Math.random() * 20) + 30;  // Photo complaints
        }
    }

    updateEngineerProfile() {
        // Update engineer profile with current data
        const staffMember = this.data.staff.find(s => s.department === "T Nagar EB Office" && s.designation.includes("Assistant Engineer"));
        if (staffMember) {
            console.log(`Engineer profile updated for: ${staffMember.name}`);
        }
    }

    handleElectricalButtonClick(button, event) {
        event.preventDefault();
        
        const action = button.dataset.action;
        const complaintId = button.dataset.complaint;
        const buttonText = button.textContent.trim();
        
        console.log(`Electrical button clicked: ${buttonText}, action: ${action}, complaint: ${complaintId}`);
        
        // Handle electrical-specific button actions
        if (action === 'view' && complaintId) {
            this.showElectricalComplaintDetails(complaintId);
        } else if (action === 'update' && complaintId) {
            this.updateElectricalComplaintStatus(complaintId);
        } else if (action === 'emergency' && complaintId) {
            this.initiateEmergencyResponse(complaintId);
        } else if (buttonText.includes('Create Work Order')) {
            this.showCreateWorkOrderDialog();
        } else if (buttonText.includes('Update Status')) {
            this.showUpdateStatusDialog(button);
        } else if (buttonText.includes('Start Work')) {
            this.startWorkOrder(button);
        } else if (buttonText.includes('Assign Engineer')) {
            this.showAssignEngineerDialog();
        } else if (buttonText.includes('Send Update')) {
            this.sendCustomerUpdate();
        } else if (buttonText.includes('Send Report')) {
            this.sendUrgentReport();
        } else if (buttonText.includes('View Photos')) {
            this.showWorkOrderPhotos();
        } else if (buttonText.includes('Emergency Response')) {
            this.showEmergencyResponseDialog();
        } else {
            // Generic button handling
            this.handleGenericButtonClick(buttonText);
        }
    }

    showElectricalComplaintDetails(complaintId) {
        const complaint = this.data.complaints.find(c => c.id === complaintId);
        if (complaint) {
            let details = `
🔌 ELECTRICAL COMPLAINT DETAILS

ID: ${complaint.id}
Title: ${complaint.title}
Location: ${complaint.location}
${complaint.landmark ? `Landmark: ${complaint.landmark}` : ''}
Status: ${complaint.status}
Priority: ${complaint.priority}
Category: ${complaint.category}
Reporter: ${complaint.reportedBy}
Phone: ${complaint.reporterPhone}

ELECTRICAL DETAILS:`;
            
            if (complaint.transformerNumber) {
                details += `\n🔌 Transformer: ${complaint.transformerNumber}`;
            }
            if (complaint.poleNumber) {
                details += `\n💡 Pole Number: ${complaint.poleNumber}`;
            }
            if (complaint.meterNumber) {
                details += `\n📊 Meter Number: ${complaint.meterNumber}`;
            }
            if (complaint.consumerNumber) {
                details += `\n👤 Consumer Number: ${complaint.consumerNumber}`;
            }
            if (complaint.affectedConsumers) {
                details += `\n👥 Affected Consumers: ${complaint.affectedConsumers}`;
            }
            if (complaint.workOrderNumber) {
                details += `\n📝 Work Order: ${complaint.workOrderNumber}`;
            }
            if (complaint.estimatedCost) {
                details += `\n💰 Estimated Cost: ₹${complaint.estimatedCost}`;
            }
            
            details += `\n\nDescription: ${complaint.description}`;
            
            if (complaint.assignedTo) {
                details += `\n\nAssigned To: ${complaint.assignedTo}`;
            }
            
            alert(details);
        }
    }

    showWorkOrderDetails(workOrderId) {
        const complaint = this.data.complaints.find(c => c.workOrderNumber === workOrderId);
        if (complaint) {
            const details = `
📋 WORK ORDER DETAILS

Work Order: ${workOrderId}
Complaint ID: ${complaint.id}
Type: ${complaint.category} - ${complaint.subCategory}
Location: ${complaint.location}
Priority: ${complaint.priority}
Status: ${complaint.status}
Assigned Engineer: ${complaint.assignedTo}
Estimated Cost: ₹${complaint.estimatedCost || 'TBD'}

Description: ${complaint.description}
            `;
            alert(details);
        }
    }

    updateElectricalComplaintStatus(complaintId) {
        const electricalStatuses = ['Open', 'Verified', 'Work Order Issued', 'In Progress', 'Testing', 'Resolved', 'Closed'];
        const currentComplaint = this.data.complaints.find(c => c.id === complaintId);
        
        if (!currentComplaint) return;
        
        const currentIndex = electricalStatuses.indexOf(currentComplaint.status);
        const nextStatus = electricalStatuses[Math.min(currentIndex + 1, electricalStatuses.length - 1)];
        
        currentComplaint.status = nextStatus;
        
        // Update the UI
        this.renderElectricalComplaints();
        
        alert(`⚡ Electrical complaint ${complaintId} status updated to: ${nextStatus}`);
    }

    initiateEmergencyResponse(complaintId) {
        const complaint = this.data.complaints.find(c => c.id === complaintId);
        if (complaint) {
            const response = `
🚨 EMERGENCY RESPONSE INITIATED

Complaint: ${complaint.id}
Type: ${complaint.category}
Location: ${complaint.location}

Actions Taken:
✅ Emergency team notified
✅ FOC Center (1912) alerted
✅ Field engineer dispatched
✅ Safety protocols activated
✅ Estimated response time: 30 minutes

Emergency Contact: 9445850811
            `;
            alert(response);
        }
    }

    showCreateWorkOrderDialog() {
        const workOrderDetails = prompt(`
📋 CREATE NEW WORK ORDER

Enter work order details:
1. Complaint ID
2. Priority (Emergency/High/Medium/Low)
3. Estimated completion hours
4. Required materials

Format: TNE2025XXX,High,4,LED Bulbs
        `);
        
        if (workOrderDetails && workOrderDetails.trim()) {
            const [id, priority, hours, materials] = workOrderDetails.split(',');
            alert(`✅ Work order created successfully!\n\nComplaint: ${id}\nPriority: ${priority}\nEstimated time: ${hours} hours\nMaterials: ${materials}`);
        }
    }

    showUpdateStatusDialog(button) {
        const workOrderCard = button.closest('.work-order-card');
        const workOrderId = workOrderCard?.querySelector('.work-order-id')?.textContent;
        
        const newStatus = prompt(`
📊 UPDATE WORK ORDER STATUS

Current Work Order: ${workOrderId}

Select new status:
1. Started
2. In Progress - 25%
3. In Progress - 50%
4. In Progress - 75%
5. Testing
6. Completed
7. Closed

Enter number (1-7):
        `);
        
        if (newStatus && newStatus.trim()) {
            const statuses = ['', 'Started', 'In Progress - 25%', 'In Progress - 50%', 'In Progress - 75%', 'Testing', 'Completed', 'Closed'];
            const selectedStatus = statuses[parseInt(newStatus)] || 'In Progress';
            alert(`✅ Work order ${workOrderId} status updated to: ${selectedStatus}`);
        }
    }

    startWorkOrder(button) {
        const workOrderCard = button.closest('.work-order-card');
        const workOrderId = workOrderCard?.querySelector('.work-order-id')?.textContent;
        const title = workOrderCard?.querySelector('h4')?.textContent;
        
        alert(`🔧 Work order ${workOrderId} started!\n\nTask: ${title}\n\n✅ Field engineer notified\n✅ Materials allocated\n✅ Safety checklist completed\n✅ Estimated completion: 4 hours`);
        
        // Update button text
        button.textContent = 'In Progress';
        button.classList.remove('btn--primary');
        button.classList.add('btn--outline');
    }

    showAssignEngineerDialog() {
        const engineers = [
            "AE Subramanian (Street Lighting)",
            "AE Ramesh Kumar (Transformers)",
            "JE Priya (Meters & Billing)",
            "Emergency Response Team"
        ];
        
        const engineerList = engineers.map((eng, idx) => `${idx + 1}. ${eng}`).join('\n');
        
        const selection = prompt(`
👷 ASSIGN ENGINEER

Available engineers:
${engineerList}

Enter number (1-4):
        `);
        
        if (selection && selection.trim()) {
            const selectedEngineer = engineers[parseInt(selection) - 1];
            if (selectedEngineer) {
                alert(`✅ Complaint assigned to: ${selectedEngineer}\n\n📱 SMS notification sent\n📧 Email notification sent\n🔔 Mobile app alert sent`);
            }
        }
    }

    sendCustomerUpdate() {
        const updateText = prompt(`
📱 SEND CUSTOMER UPDATE

Enter update message:
(Will be sent via SMS and WhatsApp to affected consumers)
        `);
        
        if (updateText && updateText.trim()) {
            alert(`✅ Update sent successfully!\n\nMessage: "${updateText}"\n\n📱 SMS sent to registered numbers\n💬 WhatsApp update sent to 9445850829\n📧 Email notification sent`);
        }
    }

    sendUrgentReport() {
        alert(`📊 URGENT REPORT SENT TO SE

Report sent to: Dr. S. Muralidharan (SE Chennai EDC)

Contents:
• Current transformer overload situation
• Affected consumer count
• Emergency response actions taken
• Resource requirements
• Estimated resolution time

✅ Report delivered via:
📱 SMS to SE mobile
📧 Email with technical details
💬 WhatsApp with photos`);
    }

    showWorkOrderPhotos() {
        alert(`📸 WORK ORDER PHOTOS

Available photos:
• Transformer load testing results
• Temperature readings
• Safety clearance documentation
• Equipment condition assessment

🔗 Photos uploaded to TANGEDCO portal
📊 Technical data recorded in system
✅ Compliance documentation complete`);
    }

    showEmergencyResponseDialog() {
        alert(`🚨 EMERGENCY RESPONSE PROTOCOL

Immediate Actions:
✅ FOC Center (1912) notified
✅ Emergency repair team dispatched  
✅ Safety perimeter established
✅ Power isolation completed
✅ Traffic management coordinated

Response Team:
👷 Lead Engineer: AE Ramesh Kumar
🚑 Safety Officer: On standby
🚔 Police coordination: Active
📡 Control room: Monitoring

ETA: 15 minutes`);
    }

    handleGenericButtonClick(buttonText) {
        const responses = {
            'View All': () => this.navigateToPage('localComplaints'),
            'New Message': () => alert('📝 New message interface would open here'),
            'Reply': () => this.showReplyInterface(),
            'Download': () => alert('📄 Electrical report download initiated'),
            'Generate Report': () => alert('📊 Custom electrical report generation started'),
            'Coordinate': () => alert('🤝 Inter-department coordination initiated'),
            'Plan Meeting': () => alert('📅 Planning meeting scheduled'),
            'View Project': () => alert('🏗️ Infrastructure project details would open'),
            'Manage Users': () => alert('👥 TANGEDCO user management interface would open'),
            'Generate Electrical Report': () => alert('⚡ Custom electrical report generation started')
        };
        
        const handler = Object.keys(responses).find(key => buttonText.includes(key));
        if (handler) {
            responses[handler]();
        } else {
            console.log(`Unhandled button: ${buttonText}`);
        }
    }

    showReplyInterface() {
        const reply = prompt('📝 Enter your reply:');
        if (reply && reply.trim()) {
            alert('✅ Reply sent successfully via internal TANGEDCO communication system');
        }
    }

    showEmergencyPanel() {
        const emergency = `
🚨 ELECTRICAL EMERGENCY PANEL

Emergency Numbers:
• FOC (Fuse Off Call): 1912
• Emergency Repair: 9445850811
• T Nagar Office: 044-2434-1101
• WhatsApp Reports: 9445850829
• SE Chennai EDC: +91 9445857001

Quick Actions:
1. Report power outage
2. Report electrical hazard
3. Request emergency repair
4. Safety incident alert

Current Emergency Status:
⚠️ 2 active emergency calls
🔧 3 emergency teams available
⚡ All critical infrastructure operational
        `;
        
        alert(emergency);
    }

    showEmergencyContacts() {
        const contacts = `
🚨 EMERGENCY CONTACTS

FOC (Fuse Off Call): 1912
Emergency Repair: 9445850811
T Nagar EB Office: 044-2434-1101
WhatsApp Chennai: 9445850829
Consumer Support: 9498794987

⚡ For immediate electrical emergencies, call 1912
📱 Send photos via WhatsApp: 9445850829
        `;
        alert(contacts);
    }

    showElectricalNotifications() {
        const notifications = `
🔔 ELECTRICAL NOTIFICATIONS

• New transformer overload alert - Ranganathan Street
• Street light repair completed - Pondy Bazaar  
• Power quality issue reported - Usman Road
• Work order WO/TNE/2025/0046 in progress
• Monthly safety inspection due
• LED upgrade project approved

🚨 2 Emergency alerts
⚠️ 1 High priority complaint
        `;
        alert(notifications);
    }

    showOfficeDetails(officeName) {
        const officeData = {
            'T Nagar EB Office': {
                performance: '91%',
                pending: '22',
                staff: '12',
                coverage: 'Pondy Bazaar, Ranganathan Street, Usman Road'
            },
            'Mylapore EB Office': {
                performance: '88%',
                pending: '28',
                staff: '10',
                coverage: 'Mylapore, Mandaveli, Luz'
            },
            'Adyar EB Office': {
                performance: '85%',
                pending: '35',
                staff: '14',
                coverage: 'Adyar, Besant Nagar, Thiruvanmiyur'
            }
        };
        
        const data = officeData[officeName];
        if (data) {
            alert(`⚡ ${officeName} Details\n\nPerformance: ${data.performance}\nPending Complaints: ${data.pending}\nStaff Count: ${data.staff}\nCoverage Area: ${data.coverage}`);
        }
    }

    showInfrastructureDetails(infraType) {
        const infraData = {
            'Transformers': 'T Nagar Area: 3 Active, 1 Overloaded (T-NG-15), 1 Maintenance Due (T-NG-08)',
            'Street Lights': '245 Total, 221 Functional, 24 Need Repair, 180 LED Upgraded',
            'Service Connections': '14,835 Active (12,450 Domestic, 2,340 Commercial, 45 Industrial)'
        };
        
        const info = infraData[infraType];
        if (info) {
            alert(`🏗️ ${infraType} Status\n\n${info}`);
        }
    }

    handleElectricalSetting(toggle) {
        const settingItem = toggle.closest('.setting-item');
        const setting = settingItem?.querySelector('span')?.textContent || 'Unknown setting';
        const enabled = toggle.checked;
        
        console.log(`Electrical setting "${setting}" ${enabled ? 'enabled' : 'disabled'}`);
        
        let message = `⚙️ Setting "${setting}" ${enabled ? 'enabled' : 'disabled'}`;
        
        // Add electrical-specific setting responses
        if (setting.includes('Emergency')) {
            message += '\n\n🚨 Emergency alerts will ' + (enabled ? 'be sent immediately' : 'be disabled');
        } else if (setting.includes('Transformer')) {
            message += '\n\n🔌 Transformer monitoring ' + (enabled ? 'activated' : 'deactivated');
        } else if (setting.includes('WhatsApp')) {
            message += '\n\n💬 WhatsApp integration ' + (enabled ? 'connected' : 'disconnected');
        }
        
        alert(message);
    }

    updateRoleSpecificData() {
        // Update data based on current role
        switch (this.currentRole) {
            case 'local':
                this.updateLocalOfficeData();
                break;
            case 'department':
                this.updateDepartmentData();
                break;
            case 'central':
                this.updateCentralData();
                break;
        }
    }

    updateLocalOfficeData() {
        // Update T Nagar EB Office specific data
        const stats = document.querySelectorAll('.stat-number');
        if (stats.length >= 4) {
            stats[0].textContent = this.data.complaints.filter(c => c.priority === 'Emergency').length;
            stats[1].textContent = this.data.complaints.filter(c => c.priority === 'High').length;
            stats[2].textContent = this.data.complaints.filter(c => c.workOrderNumber).length;
            stats[3].textContent = this.data.performance.tNagarOffice.pending;
        }
    }

    updateDepartmentData() {
        // Update Chennai EDC data
        const stats = document.querySelectorAll('.stat-number');
        if (stats.length >= 4) {
            stats[0].textContent = this.data.performance.chennaiEDC.totalComplaints;
            stats[1].textContent = this.data.performance.chennaiEDC.resolved;
            stats[2].textContent = this.data.performance.chennaiEDC.pending;
            stats[3].textContent = this.data.performance.chennaiEDC.slaCompliance;
        }
    }

    updateCentralData() {
        // Update Chennai Corporation coordination data
        const stats = document.querySelectorAll('.stat-number');
        if (stats.length >= 4) {
            stats[0].textContent = this.data.performance.chennaiEDC.officesUnderJurisdiction;
            stats[1].textContent = '89%';
            stats[2].textContent = this.data.performance.chennaiEDC.totalComplaints;
            stats[3].textContent = this.data.performance.tNagarOffice.customerSatisfaction;
        }
    }

    startRealTimeUpdates() {
        // Update notification badge periodically
        setInterval(() => {
            const change = Math.floor(Math.random() * 3) - 1;
            this.notifications = Math.max(0, this.notifications + change);
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.textContent = this.notifications;
            }
        }, 45000); // Update every 45 seconds for electrical system

        // Simulate emergency alerts
        setInterval(() => {
            if (Math.random() > 0.9 && this.currentRole === 'local') { // 10% chance
                this.showEmergencyAlert();
            }
        }, 120000); // Check every 2 minutes
    }

    showEmergencyAlert() {
        const emergencyTypes = [
            'Transformer overload detected - T-NG-15',
            'Cable spark reported - Safety hazard',
            'Power outage affecting 50+ consumers',
            'Meter explosion reported - Emergency response needed'
        ];
        
        const alert = emergencyTypes[Math.floor(Math.random() * emergencyTypes.length)];
        
        // Show emergency notification
        const notification = document.createElement('div');
        notification.className = 'emergency-notification';
        notification.style.cssText = `
            position: fixed;
            top: 70px;
            right: 16px;
            background: #dc2626;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1001;
            max-width: 300px;
            animation: slideIn 0.3s ease-out;
        `;
        
        notification.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-exclamation-triangle" style="color: #fbbf24;"></i>
                <div>
                    <strong>Emergency Alert</strong><br>
                    <small>${alert}</small>
                </div>
                <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">×</button>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Auto remove after 10 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 10000);
    }

    getTimeAgo(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffInHours = Math.floor((now - date) / (1000 * 60 * 60));
        
        if (diffInHours < 1) {
            return "Just now";
        } else if (diffInHours < 24) {
            return `${diffInHours} hours ago`;
        } else {
            const diffInDays = Math.floor(diffInHours / 24);
            return `${diffInDays} days ago`;
        }
    }
}

// Initialize the TANGEDCO Electrical Complaint Management System
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing TANGEDCO system...');
    window.electricalApp = new ElectricalComplaintApp();
});

// Add keyboard navigation for electrical emergency
document.addEventListener('keydown', (e) => {
    // Quick navigation with number keys 1-5
    if (e.key >= '1' && e.key <= '5') {
        const navItems = document.querySelectorAll('.nav-items.active .nav-item');
        const index = parseInt(e.key) - 1;
        if (navItems[index]) {
            navItems[index].click();
        }
    }
    
    // F1 key for emergency panel
    if (e.key === 'F1') {
        e.preventDefault();
        if (window.electricalApp) {
            window.electricalApp.showEmergencyPanel();
        }
    }
    
    // ESC key to close overlays
    if (e.key === 'Escape') {
        const overlay = document.getElementById('modalOverlay');
        if (overlay && !overlay.classList.contains('hidden')) {
            overlay.classList.add('hidden');
        }
        
        // Also remove emergency notifications
        document.querySelectorAll('.emergency-notification').forEach(n => n.remove());
    }
});

// Add touch gesture support for mobile
let touchStartX = 0;
let touchStartY = 0;

document.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
});
document.addEventListener("DOMContentLoaded", () => {
  const toggleButtons = document.querySelectorAll(".map-toggle-btn");
  const streetView = document.getElementById("streetMapView");
  const densityView = document.getElementById("densityMapView");

  toggleButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      // Remove active state from all buttons
      toggleButtons.forEach(b => b.classList.remove("active"));

      // Mark clicked button active
      btn.classList.add("active");

      // Switch views based on data-view attribute
      const view = btn.dataset.view;
      if (view === "street") {
        streetView.classList.add("active");
        densityView.classList.remove("active");
      } else if (view === "density") {
        densityView.classList.add("active");
        streetView.classList.remove("active");
      }
    });
  });
});


document.addEventListener('touchend', (e) => {
    if (!touchStartX || !touchStartY) return;
    
    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;
    
    const deltaX = touchEndX - touchStartX;
    const deltaY = touchEndY - touchStartY;
    
    // Only handle horizontal swipes
    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
        const currentNav = document.querySelector('.nav-items.active');
        const currentActiveNav = currentNav?.querySelector('.nav-item.active');
        
        if (currentActiveNav) {
            let nextNav;
            if (deltaX > 0) {
                nextNav = currentActiveNav.previousElementSibling;
            } else {
                nextNav = currentActiveNav.nextElementSibling;
            }
            
            if (nextNav && nextNav.classList.contains('nav-item')) {
                nextNav.click();
            }
        }
    }
    
    touchStartX = 0;
    touchStartY = 0;
});

// Performance monitoring for electrical system
const observeElectricalPageLoad = () => {
    if (window.performance && window.performance.timing) {
        const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
        console.log(`TANGEDCO system load time: ${loadTime}ms`);
    }
};

window.addEventListener('load', observeElectricalPageLoad);

// Add CSS for emergency notifications
const emergencyStyles = document.createElement('style');
emergencyStyles.textContent = `
@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}


.emergency-notification {
    animation: slideIn 0.3s ease-out;
}

.btn--emergency {
    background: #dc2626 !important;
    color: white !important;
    border: none !important;
    animation: pulse 2s infinite;
}
`;
document.head.appendChild(emergencyStyles);


    </script>
</body>
</html>